import './style.scss';
import React from 'react';
import Header from '../Header';
import CartItem from './CartItem';
import { useState, useEffect } from 'react';
import { useContext } from 'react';

import { ContainerContext } from '../../Contexts/containerProvider';

export default function Cart() {
  const dataCart = useContext(ContainerContext);

  const { listDataCart } = dataCart;

  console.log('dataList=====', listDataCart);

  const [listCart, setListCart] = useState([]);
  const [totalAll, setTotalAll] = useState(0);

  useEffect(() => {
    const newList = JSON.parse(localStorage.getItem('listCart'));
    setListCart(newList);
  }, []);

  const hadleRemove = (cartItem) => {
    const newList = listCart.filter(
      (item) => item.id !== cartItem.id
    );
    localStorage.setItem('listCart', JSON.stringify(newList));
    setListCart(newList);
    
    const newDetail = JSON.parse(localStorage.getItem('listDetail'));
    const detailItem = { ...newDetail, quantity: 1 };
    localStorage.setItem('listDetail', JSON.stringify(detailItem));
  };

  const handleDecrement = (item) => {
    if (item.quantity > 1) {
      const updatedCart = listCart.map((cartItem) => {
        if (cartItem.id === item.id) {
          return {
            ...cartItem,
            quantity: cartItem.quantity - 1,
            originalPrice: (cartItem.quantity - 1) * cartItem.price,
          };
        }

        return cartItem;
      });
      localStorage.setItem('listCart', JSON.stringify(updatedCart));
      setListCart(updatedCart);
    }
  };

  const handleIncrement = (item) => {
    const updatedCart = listCart.map((cartItem) => {
      if (cartItem.id === item.id) {
        return {
          ...cartItem,
          quantity: cartItem.quantity + 1,
          originalPrice: (cartItem.quantity + 1) * cartItem.price,
        };
      }

      return cartItem;
    });
    localStorage.setItem('listCart', JSON.stringify(updatedCart));
    setListCart(updatedCart);
  };

  useEffect(() => {
    const total = listCart.reduce((acc, item) => {
      return acc + item.price * item.quantity;
    }, 0);
    setTotalAll(total);
  }, [listCart]);
  // const dataListCart = useContext(ContainerContext);
  // const { listCartAdd } = dataListCart;

  console.log('listCartAdd========', listCart);

  return (
    <div className="Cart_Wrapper">
      <Header />
      <div className="Cart_body">
        <div className="Cart_body-top">
          <div className="Cart_body-top-wrapper">
            <div>
              <svg
                width="17"
                height="21"
                viewBox="0 0 17 21"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M0.780969 20.3C0.574712 20.3 0.376872 20.2182 0.230839 20.0726C0.0848054 19.9269 0.00249869 19.7293 0.00196915 19.523V5.77004C0.00131058 5.66723 0.0209594 5.56529 0.0597883 5.47009C0.0986172 5.37489 0.155862 5.28829 0.228238 5.21526C0.300614 5.14224 0.386698 5.08422 0.481549 5.04454C0.5764 5.00486 0.678153 4.9843 0.780969 4.98404H3.16697C3.32212 3.69357 3.94475 2.50469 4.91713 1.64221C5.8895 0.779738 7.14421 0.303467 8.44397 0.303467C9.74373 0.303467 10.9984 0.779738 11.9708 1.64221C12.9432 2.50469 13.5658 3.69357 13.721 4.98404H16.102C16.2053 4.98364 16.3077 5.0037 16.4032 5.04306C16.4988 5.08242 16.5856 5.14031 16.6586 5.21337C16.7317 5.28644 16.7896 5.37324 16.8289 5.46878C16.8683 5.56432 16.8884 5.66671 16.888 5.77004V19.523C16.8874 19.6257 16.8667 19.7272 16.8269 19.8218C16.7871 19.9165 16.729 20.0023 16.656 20.0745C16.583 20.1466 16.4965 20.2037 16.4015 20.2424C16.3064 20.2811 16.2046 20.3007 16.102 20.3H0.780969ZM4.74397 4.98404H12.144C11.9968 4.10917 11.5443 3.31475 10.867 2.74183C10.1896 2.16891 9.33114 1.85454 8.44397 1.85454C7.5568 1.85454 6.69833 2.16891 6.02097 2.74183C5.3436 3.31475 4.89116 4.10917 4.74397 4.98404Z"
                  fill="#C92027"
                ></path>
                <path
                  d="M12.634 8.65607V6.78107H14.381V8.65607C14.381 9.00107 13.99 9.28107 13.508 9.28107C13.026 9.28107 12.634 9.00107 12.634 8.65607ZM2.50195 8.65607V6.78107H4.24895V8.65607C4.24895 9.00107 3.85795 9.28107 3.37495 9.28107C2.89195 9.28107 2.50195 9.00107 2.50195 8.65607Z"
                  fill="white"
                ></path>
              </svg>
              <span className="span_color">Giỏ hàng</span>
            </div>
            <div className="border-hyphen">-------</div>
            <div>
              <svg
                width="17"
                height="19"
                viewBox="0 0 17 19"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M13.35 0.806049C13.2609 0.652538 13.1331 0.525046 12.9794 0.436268C12.8257 0.347491 12.6515 0.300525 12.474 0.300049H8.70996V4.75205H15.633L13.35 0.806049Z"
                  fill="#999999"
                ></path>
                <path
                  d="M7.65586 0.300049H3.85586C3.67808 0.300351 3.5035 0.347343 3.34959 0.43632C3.19568 0.525297 3.06784 0.653138 2.97886 0.807049L0.703857 4.75205H7.65386V0.300049H7.65586Z"
                  fill="#999999"
                ></path>
                <path
                  d="M0.326904 5.80707V17.0591C0.327434 17.3879 0.458386 17.7032 0.691032 17.9357C0.923679 18.1681 1.23903 18.2988 1.56791 18.2991H14.7619C15.0908 18.2988 15.4061 18.1681 15.6388 17.9357C15.8714 17.7032 16.0024 17.3879 16.0029 17.0591V5.80707H0.326904ZM10.5599 10.5391L7.83191 13.2671C7.78296 13.3161 7.72482 13.355 7.66081 13.3816C7.59681 13.4081 7.5282 13.4218 7.4589 13.4218C7.38961 13.4218 7.321 13.4081 7.257 13.3816C7.193 13.355 7.13486 13.3161 7.08591 13.2671L5.8069 11.9881C5.75437 11.9399 5.71212 11.8816 5.68272 11.8167C5.65332 11.7518 5.63736 11.6816 5.63581 11.6103C5.63426 11.5391 5.64716 11.4683 5.67371 11.4021C5.70027 11.336 5.73994 11.2759 5.79034 11.2255C5.84073 11.1751 5.90081 11.1354 5.96694 11.1089C6.03308 11.0823 6.10391 11.0694 6.17516 11.071C6.24641 11.0725 6.31661 11.0885 6.38153 11.1179C6.44645 11.1473 6.50475 11.1895 6.55291 11.2421L7.4589 12.1481L9.8149 9.79207C9.86389 9.74309 9.92204 9.70423 9.98604 9.67772C10.05 9.65121 10.1186 9.63757 10.1879 9.63757C10.2572 9.63757 10.3258 9.65121 10.3898 9.67772C10.4538 9.70423 10.5119 9.74309 10.5609 9.79207C10.6099 9.84105 10.6487 9.89921 10.6753 9.96321C10.7018 10.0272 10.7154 10.0958 10.7154 10.1651C10.7154 10.2343 10.7018 10.3029 10.6753 10.3669C10.6487 10.4309 10.6099 10.4891 10.5609 10.5381L10.5599 10.5391Z"
                  fill="#999999"
                ></path>
              </svg>
              <span>Đặt hàng</span>
            </div>
            <div className="border-hyphen">-------</div>
            <div>
              <svg
                width="21"
                height="21"
                viewBox="0 0 21 21"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M16.3259 9.70705V0.930049C16.3259 0.762962 16.2596 0.602719 16.1414 0.484572C16.0233 0.366424 15.863 0.300049 15.6959 0.300049L11.3039 0.300049V6.52405C11.3043 6.63809 11.2736 6.75007 11.2153 6.84807C11.157 6.94607 11.0732 7.0264 10.9728 7.08049C10.8724 7.13459 10.7592 7.16042 10.6453 7.15524C10.5314 7.15005 10.421 7.11404 10.3259 7.05105L8.32593 5.73905L6.32593 7.05105C6.23091 7.11324 6.12084 7.14859 6.00738 7.15336C5.89391 7.15812 5.78127 7.13213 5.68136 7.07813C5.58146 7.02413 5.49801 6.94413 5.43984 6.8466C5.38167 6.74906 5.35095 6.63761 5.35093 6.52405V0.300049H0.955928C0.788841 0.300049 0.628598 0.366424 0.51045 0.484572C0.392303 0.602719 0.325928 0.762962 0.325928 0.930049L0.325928 14.23C0.325928 14.3128 0.342223 14.3947 0.373884 14.4711C0.405544 14.5476 0.45195 14.617 0.51045 14.6755C0.568951 14.734 0.638402 14.7804 0.714837 14.8121C0.791272 14.8438 0.873195 14.86 0.955928 14.86H10.0709C10.3089 13.3875 11.0752 12.0522 12.2265 11.1037C13.3777 10.1553 14.8351 9.65877 16.3259 9.70705Z"
                  fill="#999999"
                ></path>
                <path
                  d="M8.67093 4.45905L10.0439 5.35905V0.300049H6.60693V5.35805L7.97993 4.45805C8.08259 4.39063 8.20277 4.35479 8.32559 4.35497C8.44841 4.35514 8.56847 4.39133 8.67093 4.45905Z"
                  fill="#999999"
                ></path>
                <path
                  d="M16.5559 12.4811C15.8103 12.4811 15.0814 12.7022 14.4614 13.1164C13.8414 13.5307 13.3582 14.1195 13.0729 14.8083C12.7875 15.4972 12.7129 16.2553 12.8583 16.9866C13.0038 17.7179 13.3629 18.3896 13.8901 18.9169C14.4173 19.4441 15.0891 19.8032 15.8204 19.9486C16.5517 20.0941 17.3097 20.0194 17.9986 19.7341C18.6875 19.4488 19.2763 18.9656 19.6905 18.3456C20.1048 17.7256 20.3259 16.9967 20.3259 16.2511C20.3248 15.2515 19.9273 14.2932 19.2205 13.5865C18.5137 12.8797 17.5554 12.4821 16.5559 12.4811ZM18.7759 15.5811L16.2959 18.0621C16.2044 18.1535 16.0803 18.2049 15.9509 18.2049C15.8215 18.2049 15.6974 18.1535 15.6059 18.0621L14.2429 16.6991C14.1961 16.6541 14.1587 16.6002 14.133 16.5406C14.1073 16.4811 14.0937 16.4169 14.0931 16.3521C14.0924 16.2872 14.1047 16.2228 14.1293 16.1627C14.1538 16.1026 14.1901 16.048 14.236 16.0021C14.2818 15.9562 14.3365 15.92 14.3965 15.8954C14.4566 15.8709 14.521 15.8586 14.5859 15.8592C14.6508 15.8599 14.7149 15.8735 14.7745 15.8992C14.8341 15.9249 14.8879 15.9623 14.9329 16.0091L15.9509 17.0271L18.0859 14.8921C18.178 14.8035 18.3011 14.7547 18.4289 14.756C18.5566 14.7572 18.6788 14.8085 18.7691 14.8989C18.8594 14.9892 18.9107 15.1113 18.912 15.2391C18.9133 15.3668 18.8644 15.49 18.7759 15.5821V15.5811Z"
                  fill="#999999"
                ></path>
              </svg>
              <span>Hoàn thành đơn hàng</span>
            </div>
          </div>
        </div>
        <div className="Cart_body-content">
          <div className="Cart_body-content-left">
            <div className="Cart_body-content-left-voucher">
              <div>
                <svg
                  width="21"
                  height="14"
                  viewBox="0 0 21 14"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M19.4059 3.22408C19.0639 2.85501 18.6503 2.56303 18.1915 2.36688C17.7327 2.17072 17.2388 2.07472 16.7415 2.08503H13.9962V0.510786C13.9962 0.375317 13.9435 0.245396 13.8498 0.149605C13.756 0.0538144 13.6289 0 13.4963 0H0.999389C0.866813 0 0.739668 0.0538144 0.645922 0.149605C0.552177 0.245396 0.499512 0.375317 0.499512 0.510786L0.499512 11.8073C0.499512 11.9428 0.552177 12.0727 0.645922 12.1685C0.739668 12.2643 0.866813 12.3181 0.999389 12.3181H2.9989C3.07719 12.7885 3.31589 13.2155 3.6727 13.5233C4.02952 13.8311 4.48144 14 4.94842 14C5.4154 14 5.86732 13.8311 6.22413 13.5233C6.58095 13.2155 6.81964 12.7885 6.89794 12.3181H14.596C14.6743 12.7885 14.913 13.2155 15.2699 13.5233C15.6267 13.8311 16.0786 14 16.5456 14C17.0126 14 17.4645 13.8311 17.8213 13.5233C18.1781 13.2155 18.4168 12.7885 18.4951 12.3181H19.9947C20.1273 12.3181 20.2544 12.2643 20.3482 12.1685C20.4419 12.0727 20.4946 11.9428 20.4946 11.8073V6.49516C20.5484 5.30353 20.1595 4.13514 19.4059 3.22408ZM1.51026 1.02361H12.9964V11.2976H6.81296C6.67622 10.9053 6.42404 10.5659 6.09101 10.3258C5.75799 10.0858 5.36045 9.95696 4.95292 9.95696C4.54539 9.95696 4.14784 10.0858 3.81482 10.3258C3.4818 10.5659 3.22962 10.9053 3.09287 11.2976H1.50526L1.51026 1.02361ZM4.95242 12.9668C4.76022 12.9668 4.57234 12.9086 4.41254 12.7995C4.25273 12.6904 4.12818 12.5353 4.05463 12.3538C3.98108 12.1724 3.96183 11.9728 3.99933 11.7801C4.03682 11.5875 4.12938 11.4106 4.26528 11.2717C4.40118 11.1328 4.57433 11.0383 4.76284 11C4.95134 10.9616 5.14673 10.9813 5.32429 11.0565C5.50186 11.1316 5.65363 11.2589 5.76041 11.4222C5.86719 11.5855 5.92418 11.7775 5.92418 11.9739C5.92391 12.2371 5.82145 12.4895 5.63926 12.6757C5.45708 12.8618 5.21006 12.9666 4.95242 12.9668ZM16.5436 12.9668C16.3514 12.9668 16.1635 12.9086 16.0037 12.7995C15.8439 12.6904 15.7193 12.5353 15.6458 12.3538C15.5722 12.1724 15.553 11.9728 15.5905 11.7801C15.628 11.5875 15.7205 11.4106 15.8564 11.2717C15.9923 11.1328 16.1655 11.0383 16.354 11C16.5425 10.9616 16.7379 10.9813 16.9154 11.0565C17.093 11.1316 17.2448 11.2589 17.3516 11.4222C17.4583 11.5855 17.5153 11.7775 17.5153 11.9739C17.5151 12.2369 17.4127 12.4892 17.2308 12.6753C17.0488 12.8615 16.802 12.9663 16.5446 12.9668H16.5436ZM19.4848 11.2935H18.4041C18.2674 10.9012 18.0152 10.5618 17.6822 10.3217C17.3491 10.0817 16.9516 9.95287 16.5441 9.95287C16.1365 9.95287 15.739 10.0817 15.406 10.3217C15.073 10.5618 14.8208 10.9012 14.684 11.2935H14.0012V3.11273H16.7455C18.4381 3.11273 19.4898 4.41013 19.4898 6.49822V11.2925L19.4848 11.2935Z"
                    fill="black"
                  ></path>
                </svg>
                <div>
                  <span>Miễn phí vận chuyển</span>
                  cho đơn hàng có giá trị hơn 500.000 đ
                </div>
              </div>
              <svg
                width="16"
                height="16"
                viewBox="0 0 16 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M8.30908 4.90898C8.74041 4.90898 9.09008 4.55932 9.09008 4.12798C9.09008 3.69665 8.74041 3.34698 8.30908 3.34698C7.87774 3.34698 7.52808 3.69665 7.52808 4.12798C7.52808 4.55932 7.87774 4.90898 8.30908 4.90898Z"
                  fill="black"
                ></path>
                <path
                  d="M13.657 2.34299C12.1566 0.842663 10.1217 -0.000213639 7.99996 -0.000213623C5.87818 -0.000213607 3.84329 0.842663 2.34296 2.34299C0.842632 3.84332 -0.000244125 5.87821 -0.000244141 7.99999C-0.000244156 10.1218 0.842632 12.1567 2.34296 13.657C3.84329 15.1573 5.87818 16.0002 7.99996 16.0002C10.1217 16.0002 12.1566 15.1573 13.657 13.657C15.1573 12.1567 16.0002 10.1218 16.0002 7.99999C16.0002 5.87821 15.1573 3.84332 13.657 2.34299ZM7.99996 14.75C6.66494 14.75 5.35989 14.3541 4.24986 13.6124C3.13983 12.8707 2.27467 11.8165 1.76377 10.5831C1.25288 9.3497 1.11921 7.9925 1.37966 6.68313C1.64011 5.37376 2.28299 4.17103 3.22699 3.22702C4.171 2.28302 5.37373 1.64014 6.6831 1.37969C7.99247 1.11924 9.34967 1.25291 10.5831 1.76381C11.8165 2.2747 12.8707 3.13986 13.6124 4.24989C14.3541 5.35993 14.75 6.66497 14.75 7.99999C14.7478 9.78955 14.036 11.5052 12.7706 12.7706C11.5052 14.036 9.78952 14.7479 7.99996 14.75Z"
                  fill="black"
                ></path>
                <path
                  d="M8.70403 11.44C8.66036 11.4612 8.61173 11.47 8.5634 11.4656C8.51507 11.4611 8.46888 11.4435 8.42984 11.4146C8.3908 11.3858 8.36039 11.3468 8.34192 11.3019C8.32344 11.2571 8.3176 11.208 8.32503 11.16L8.86102 7.58902C8.90267 7.31562 8.86875 7.03604 8.76291 6.78055C8.65707 6.52505 8.48336 6.30337 8.26059 6.13951C8.03782 5.97565 7.77446 5.87585 7.49904 5.8509C7.22362 5.82596 6.94661 5.87684 6.69803 5.99801L5.92603 6.37401L6.47403 7.49801L7.24603 7.12102C7.2897 7.09983 7.33833 7.09099 7.38666 7.09546C7.43499 7.09993 7.48118 7.11753 7.52022 7.14638C7.55926 7.17522 7.58966 7.21419 7.60814 7.25908C7.62661 7.30396 7.63246 7.35305 7.62503 7.40101L7.08904 10.972C7.04702 11.2455 7.0807 11.5253 7.18643 11.781C7.29216 12.0367 7.46589 12.2585 7.68878 12.4225C7.91167 12.5864 8.17521 12.6862 8.45079 12.711C8.72637 12.7357 9.00347 12.6846 9.25203 12.563L10.024 12.187L9.47603 11.063L8.70403 11.44Z"
                  fill="black"
                ></path>
              </svg>
            </div>
            <div className="Cart_body-content-left-tow">
              <h2>GIỎ HÀNG</h2>{' '}
              <span>({listCart.length} sản phẩm)</span>
            </div>
            <div className="Cart_body-content-left-product">
              <table>
                <thead>
                  <tr>
                    <th></th>
                    <th>Tên hàng</th>
                    <th>Giá</th>
                    <th>Số lượng</th>
                    <th>Tổng</th>
                  </tr>
                </thead>

                <tbody>
                  {listCart.length ? (
                    listCart.map((item) => (
                      <CartItem
                        key={item.id}
                        item={item}
                        image={item.image}
                        onRemove={(item) => hadleRemove(item)}
                        onDecrement={(item) => handleDecrement(item)}
                        onIncrement={(item) => handleIncrement(item)}
                      />
                    ))
                  ) : (
                    <tr className="Cart_Noproduct">
                      <th colSpan="5">Mua hàng đi bạn êi</th>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
          <div className="Cart_body-content-right">
            <h2>ĐƠN HÀNG</h2>
            <div className="Cart_body-content-right-total">
              <span>Tổng giá trị đơn hàng:</span>
              <span className="Cart_body-content-right-total-tow">
                {totalAll}
              </span>
            </div>
            <div className="Cart_body-content-right-pay">
              <span>Tiếp tục thanh toán </span>
            </div>
            <p>
              Dùng mã giảm giá của <span>TokyoLife</span> trong bước
              tiếp theo
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}
